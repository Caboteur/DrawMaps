<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src="http://cdn.pubnub.com/pubnub-3.7.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.css' rel='stylesheet' />

  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
    #map {
      position:absolute;
      width: 100%;
      height: 100%;
    }
    svg {
      position: absolute;
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script>

  var lat = 	-0.580816;
  var lng = 44.8333;
  var tab =[[	-0.580816,44.8333]];

    mapboxgl.accessToken = 'pk.eyJ1IjoiYWRyaWJveiIsImEiOiJjamJucXhjbzc0ZXdjMnh0YnJqMWI4NmR1In0.HMv4BpyCUAid4JwcIJ9Yjg';
    const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/adriboz/cjbyym823fq1q2spfl0mpfx1x',
    center: [	-0.580816,44.8333],
    zoom: 14.1
    });


if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(function(position) {
	var locationMarker = null;
	if (locationMarker){
	  // return if there is a locationMarker bug
	  return;
	}

	// sets default position to your position
	lat = position.coords["latitude"];
	lng = position.coords["longitude"];
  var el = document.createElement('div');
el.className = 'marker';
el.style.backgroundImage = 'url(https://animagehub.com/wp-content/uploads/2016/10/circle-vector-2.png)';
el.style.background = "red";
el.style.width = 50+'px';
el.style.height = 50+'px';
new mapboxgl.Marker(el)
    .setLngLat([lng,lat])
    .addTo(map);


  console.log(lat)
  setInterval(function(){lat = position.coords["latitude"];
	lng = position.coords["longitude"];


  tab.push(coordo);
  Line();
  console.log(tab);
    new mapboxgl.Marker(el)
        .setLngLat([lng,lat])
        .addTo(map);
    console.log(lat)}, 5000);
	},
	function(error) {
	console.log("Error: ", error);
	},
	{
	enableHighAccuracy: true
	}
);
}

function Line(){
    if (map.getLayer('route')){
  map.removeLayer('route')
map.removeSource('route');
}
     console.log("ok")
    map.addLayer({
        "id": "route",
        "type": "line",
        "source": {
            "type": "geojson",
            "data": {
                "type": "Feature",
                "properties": {},
                "geometry": {
                    "type": "LineString",
                    "coordinates": tab
                }
            }
        },
        "layout": {
            "line-join": "round",
            "line-cap": "round"
        },
        "paint": {
            "line-color": "#888",
            "line-width": 8
        }
    });


}



    </script>
</body>
</html>
